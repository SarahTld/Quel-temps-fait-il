import{r as h,g as T,j as W,c as r,a as t,l as v,t as l,F as R,y as A,o as d}from"./DuGDK2SR.js";import{u as H}from"./aARV7R7-.js";const B={class:"flex flex-col items-center pt-8 pb-16 px-2"},K={class:"w-full max-w-7xl flex flex-col md:flex-row gap-2",style:{height:"80vh","min-height":"500px"}},N={class:"flex-[1.5] flex flex-col justify-start items-center"},O={key:0,class:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-3xl p-4 shadow-lg border border-white/40 dark:border-gray-700/40 flex flex-col justify-between max-w-md w-full"},Y={class:"flex flex-col items-center mb-4"},q=["src","alt"],G={class:"text-4xl font-bold text-blue-800 dark:text-blue-100"},J={class:"text-lg text-blue-600 dark:text-blue-300 capitalize"},Q={class:"flex flex-col items-center mb-6"},X={class:"text-2xl font-bold text-blue-700 dark:text-blue-200"},Z={class:"flex flex-col items-center mt-1"},tt={class:"text-blue-500 dark:text-blue-300 text-sm"},et={class:"text-blue-400 dark:text-blue-400 text-xs mt-1 mb-6"},st={class:"grid grid-cols-2 gap-2 text-center mb-2"},lt={class:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-2"},ot={class:"text-lg font-bold text-blue-800 dark:text-blue-100"},at={class:"bg-red-50 dark:bg-red-900/30 rounded-lg p-2"},it={class:"text-lg font-bold text-red-800 dark:text-red-100"},nt={class:"bg-green-50 dark:bg-green-900/30 rounded-lg p-2 col-span-2"},rt={class:"text-lg font-bold text-green-800 dark:text-green-100"},dt={class:"grid grid-cols-2 gap-2 text-center"},ct={class:"bg-white/50 dark:bg-gray-700/50 rounded-lg p-2"},ut={class:"text-base font-semibold text-blue-800 dark:text-blue-100"},xt={class:"bg-white/50 dark:bg-gray-700/50 rounded-lg p-2"},pt={class:"text-base font-semibold text-blue-800 dark:text-blue-100"},bt={class:"bg-white/50 dark:bg-gray-700/50 rounded-lg p-2"},mt={class:"text-base font-semibold text-blue-800 dark:text-blue-100"},gt={class:"bg-white/50 dark:bg-gray-700/50 rounded-lg p-2"},ht={class:"text-base font-semibold text-blue-800 dark:text-blue-100"},vt={class:"bg-purple-50 dark:bg-purple-900/30 rounded-lg p-2 col-span-2"},ft={class:"text-lg font-bold text-purple-800 dark:text-purple-100"},_t={class:"flex-[2] flex flex-col max-h-full"},wt={key:0,class:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl p-6 shadow-lg border border-white/40 dark:border-gray-700/40 min-h-0 overflow-hidden flex flex-col justify-start max-h-[240px] ml-0"},kt={class:"grid grid-cols-6 gap-2 pb-2 items-end h-full"},yt={class:"text-xs text-blue-600 dark:text-blue-400"},Mt={class:"flex flex-col items-center"},Lt=["src","alt"],$t={class:"text-base font-bold text-blue-800 dark:text-blue-200 mb-1"},Et={class:"text-xs text-blue-600 dark:text-blue-400 capitalize"},jt={class:"text-xs text-blue-500 dark:text-blue-300"},Ft={key:1,class:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl p-6 mt-10 shadow-lg border border-white/40 dark:border-gray-700/40 min-h-0 overflow-hidden max-h-[320px] flex flex-col justify-start"},Rt={class:"flex overflow-x-auto space-x-4 pb-2 items-end h-full justify-center"},At={class:"text-base font-semibold text-blue-800 dark:text-blue-200 mb-1"},Dt=["src","alt"],Pt={class:"text-lg font-bold text-blue-800 dark:text-blue-200 mb-1"},It={class:"text-xs text-blue-600 dark:text-blue-400 capitalize mb-1"},Ct={class:"flex justify-center space-x-1 text-xs"},St={class:"text-red-600 dark:text-red-400"},Vt={class:"text-blue-600 dark:text-blue-400"},Ut={class:"text-xs text-blue-500 dark:text-blue-300 mt-1"},zt={key:0,class:"text-center py-20"},Tt={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded-lg text-center"},Wt={class:"text-lg font-semibold mb-2"},Ht={key:2,class:"text-center py-20"},Bt="https://api.openweathermap.org/data/2.5/weather",Kt="https://api.openweathermap.org/data/2.5/forecast",Nt="https://api.openweathermap.org/data/2.5/onecall",Jt={__name:"index",setup(Ot){const a=h(null),f=h(null),k=h(null),L=h(null),g=h(!1),x=h(""),y=T().public.openweatherKey,{getApiUnits:$,formatTemperature:c,formatWindSpeed:M}=H();W(()=>{_(),window.addEventListener("units-changed",()=>{a.value&&_()})});async function _(){if(g.value=!0,x.value="",!navigator.geolocation){x.value="La géolocalisation n'est pas supportée par votre navigateur",g.value=!1;return}navigator.geolocation.getCurrentPosition(async u=>{try{const{latitude:e,longitude:s}=u.coords;await Promise.all([D(e,s),P(e,s),I(e,s)])}catch(e){x.value="Erreur lors de la récupération de la météo",console.error(e)}finally{g.value=!1}},()=>{x.value="Impossible d'obtenir votre position. Vérifiez les permissions de géolocalisation.",g.value=!1})}async function D(u,e){const s=`${Bt}?lat=${u}&lon=${e}&appid=${y}&units=${$()}&lang=fr`,n=await fetch(s);if(!n.ok)throw new Error("Erreur API météo");const o=await n.json(),w=new Date;a.value={city:o.name,temp:c(o.main.temp),tempMin:c(o.main.temp_min),tempMax:c(o.main.temp_max),feelsLike:c(o.main.feels_like),humidity:o.main.humidity,pressure:o.main.pressure,wind:M(o.wind.speed),visibility:Math.round(o.visibility/1e3),uv:Math.round(o.main.temp/10),description:o.weather[0].description,icon:`https://openweathermap.org/img/wn/${o.weather[0].icon}@2x.png`,date:w.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),time:w.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}}async function P(u,e){const s=`${Kt}?lat=${u}&lon=${e}&appid=${y}&units=${$()}&lang=fr`,n=await fetch(s);if(!n.ok)throw new Error("Erreur API prévisions");const o=await n.json(),w=new Date,E=o.list.findIndex(i=>new Date(i.dt*1e3)>=w),j=E>=0?E:0,C=o.list.slice(j,j+6);f.value=C.map(i=>({time:new Date(i.dt*1e3).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),temp:c(i.main.temp),description:i.weather[0].description,icon:`https://openweathermap.org/img/wn/${i.weather[0].icon}@2x.png`,wind:M(i.wind.speed)})),console.log("Prévisions heure par heure:",f.value);const p={};o.list.forEach(i=>{const F=new Date(i.dt*1e3),b=F.toLocaleDateString("fr-FR",{weekday:"short"}),m=F.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"});if(!p[b+m])p[b+m]={date:b,fullDate:m,temp:c(i.main.temp),tempMin:c(i.main.temp_min),tempMax:c(i.main.temp_max),humidity:i.main.humidity,wind:M(i.wind.speed),description:i.weather[0].description,icon:`https://openweathermap.org/img/wn/${i.weather[0].icon}@2x.png`};else{const S=parseFloat(p[b+m].tempMin.replace(/[^\d.-]/g,"")),V=parseFloat(p[b+m].tempMax.replace(/[^\d.-]/g,"")),U=Math.min(S,i.main.temp_min),z=Math.max(V,i.main.temp_max);p[b+m].tempMin=c(U),p[b+m].tempMax=c(z)}}),k.value=Object.values(p).slice(0,5)}async function I(u,e){const s=`${Nt}?lat=${u}&lon=${e}&appid=${y}&lang=fr&units=metric`;try{const n=await fetch(s);if(!n.ok)throw new Error("Erreur API alertes");const o=await n.json();L.value=o.alerts&&o.alerts.length?o.alerts:null}catch{L.value=null}}return(u,e)=>(d(),r("div",B,[t("div",K,[t("div",N,[a.value?(d(),r("div",O,[t("div",null,[t("div",Y,[t("img",{src:a.value.icon,alt:a.value.description,class:"w-20 h-20 mx-auto mb-2"},null,8,q),t("div",G,l(a.value.temp),1),t("div",J,l(a.value.description),1)]),t("div",Q,[t("h1",X,l(a.value.city),1),t("div",Z,[t("span",tt,l(a.value.date),1),t("span",et,l(a.value.time),1)])]),t("div",st,[t("div",lt,[e[0]||(e[0]=t("div",{class:"text-xs text-blue-600 dark:text-blue-300"},"Min",-1)),t("div",ot,l(a.value.tempMin),1)]),t("div",at,[e[1]||(e[1]=t("div",{class:"text-xs text-red-600 dark:text-red-300"},"Max",-1)),t("div",it,l(a.value.tempMax),1)]),t("div",nt,[e[2]||(e[2]=t("div",{class:"text-xs text-green-600 dark:text-green-300"},"Ressenti",-1)),t("div",rt,l(a.value.feelsLike),1)])]),t("div",dt,[t("div",ct,[e[3]||(e[3]=t("div",{class:"text-xs text-blue-600 dark:text-blue-300"},"Humidité",-1)),t("div",ut,l(a.value.humidity)+"%",1)]),t("div",xt,[e[4]||(e[4]=t("div",{class:"text-xs text-blue-600 dark:text-blue-300"},"Vent",-1)),t("div",pt,l(a.value.wind),1)]),t("div",bt,[e[5]||(e[5]=t("div",{class:"text-xs text-blue-600 dark:text-blue-300"},"Pression",-1)),t("div",mt,l(a.value.pressure)+" hPa",1)]),t("div",gt,[e[6]||(e[6]=t("div",{class:"text-xs text-blue-600 dark:text-blue-300"},"Visibilité",-1)),t("div",ht,l(a.value.visibility)+" km",1)]),t("div",vt,[e[7]||(e[7]=t("div",{class:"text-xs text-purple-600 dark:text-purple-300"},"Indice UV",-1)),t("div",ft,l(a.value.uv),1)])])])])):v("",!0)]),t("div",_t,[f.value?(d(),r("div",wt,[e[8]||(e[8]=t("h2",{class:"text-lg font-bold text-blue-700 dark:text-blue-300 mb-2 text-center"},"Prévisions heure par heure",-1)),t("div",kt,[(d(!0),r(R,null,A(f.value,(s,n)=>(d(),r("div",{key:n,class:"bg-white/60 dark:bg-gray-700/60 rounded-xl p-2 text-center flex flex-col justify-between h-full"},[t("div",yt,l(s.time),1),t("div",Mt,[t("img",{src:s.icon,alt:s.description,class:"w-8 h-8 mx-auto mb-1"},null,8,Lt),t("div",$t,l(s.temp),1),t("div",Et,l(s.description),1),t("div",jt,l(s.wind),1)])]))),128))])])):v("",!0),k.value?(d(),r("div",Ft,[e[9]||(e[9]=t("h2",{class:"text-lg font-bold text-blue-700 dark:text-blue-300 mb-4 text-center"},"Prévisions sur 5 jours",-1)),t("div",Rt,[(d(!0),r(R,null,A(k.value,(s,n)=>(d(),r("div",{key:n,class:"flex-shrink-0 bg-white/60 dark:bg-gray-700/60 rounded-xl p-4 text-center min-w-[100px] h-52 flex flex-col justify-between"},[t("div",At,l(s.date),1),t("img",{src:s.icon,alt:s.description,class:"w-10 h-10 mx-auto mb-1"},null,8,Dt),t("div",Pt,l(s.temp),1),t("div",It,l(s.description),1),t("div",Ct,[t("span",St,l(s.tempMax),1),t("span",Vt,l(s.tempMin),1)]),t("div",Ut,[t("div",null,"Humidité: "+l(s.humidity)+"%",1),t("div",null,"Vent: "+l(s.wind),1)])]))),128))])])):v("",!0)])]),g.value?(d(),r("div",zt,e[10]||(e[10]=[t("div",{class:"animate-spin w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),t("p",{class:"text-xl text-blue-600 dark:text-blue-400"},"Localisation en cours...",-1)]))):v("",!0),x.value?(d(),r("div",Tt,[t("p",Wt,l(x.value),1),t("button",{onClick:_,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"}," Réessayer ")])):v("",!0),!a.value&&!g.value&&!x.value?(d(),r("div",Ht,[e[11]||(e[11]=t("p",{class:"text-xl text-blue-600 dark:text-blue-400 mb-4"},"Autorisez la géolocalisation pour voir la météo",-1)),t("button",{onClick:_,class:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"}," Autoriser la localisation ")])):v("",!0)]))}};export{Jt as default};
